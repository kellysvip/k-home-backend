import request from "supertest";
import app from "../../../app";

describe("Posts", () => {
  test("GET / --> Get all posts an user can see with pagination", async () => {
    const { body } = await request(app)
      .get("/api/posts")
      .set(
        "Authorization",
        "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MzliNjFiMGRiMjg5YzhjZGE3Y2U1OTUiLCJpYXQiOjE2NzI1OTI3OTQsImV4cCI6MTY3MjY3OTE5NH0.3oi8Wbl1WEsxtIXJugwzKkif6UcxzMeriDwt4wyJ5Ls"
      )
      .query({ page: 1, limit: 10 })
      .expect(200);
    expect(body).toEqual({
      data: {
        posts: [
          {
            _id: "63b13b4a16825bd098f97d1a",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "updated",
            imageUrl: "test",
            address: "test",
            price: 32,
            noBedroom: 6,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2023-01-01T07:50:34.667Z",
            updatedAt: "2023-01-01T08:09:54.972Z",
            __v: 0,
          },
          {
            _id: "63b1c0d25d9b92064ad654d5",
            author: {
              _id: "639b61b0db289c8cda7ce595",
              name: "Testman",
              email: "saobien1412@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-15T18:04:32.145Z",
              updatedAt: "2023-01-02T15:16:21.313Z",
              __v: 0,
            },
            title: "test",
            imageUrl: "test",
            address: "test",
            price: 32,
            noBedroom: 6,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2023-01-01T17:20:18.524Z",
            updatedAt: "2023-01-01T17:20:18.524Z",
            __v: 0,
          },
          {
            _id: "63b13982863e4dbc14939986",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "test",
            imageUrl: "test",
            address: "test",
            price: 32,
            noBedroom: 5,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2023-01-01T07:42:58.088Z",
            updatedAt: "2023-01-01T07:42:58.088Z",
            __v: 0,
          },
          {
            _id: "63b13b4016825bd098f97d15",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "test",
            imageUrl: "test",
            address: "test",
            price: 32,
            noBedroom: 5,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2023-01-01T07:50:24.790Z",
            updatedAt: "2023-01-01T07:50:24.790Z",
            __v: 0,
          },
          {
            _id: "63b13992863e4dbc1493998b",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "test",
            imageUrl: "test",
            address: "test",
            price: 32,
            noBedroom: 5,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2023-01-01T07:43:14.210Z",
            updatedAt: "2023-01-01T07:43:14.210Z",
            __v: 0,
          },
          {
            _id: "639dec3fb4dd9fe794100416",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "updated",
            imageUrl: "test",
            address: "test",
            price: 32,
            noBedroom: 5,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2022-12-17T16:20:15.023Z",
            updatedAt: "2022-12-17T16:22:05.717Z",
            __v: 0,
          },
          {
            _id: "639de80e34516dfd02f27efc",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "hi",
            imageUrl: "hi",
            address: "hi",
            price: 32,
            noBedroom: 5,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2022-12-17T16:02:22.857Z",
            updatedAt: "2022-12-17T16:02:22.857Z",
            __v: 0,
          },
          {
            _id: "639d71a6158f11fe11a4626c",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "hi",
            imageUrl: "hi",
            address: "hi",
            price: 32,
            noBedroom: 5,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2022-12-17T07:37:10.930Z",
            updatedAt: "2022-12-17T07:37:10.930Z",
            __v: 0,
          },
          {
            _id: "639de95f2bc9f41a9529f126",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "test",
            imageUrl: "test",
            address: "test",
            price: 32,
            noBedroom: 5,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2022-12-17T16:07:59.634Z",
            updatedAt: "2023-01-02T15:16:19.803Z",
            __v: 0,
          },
          {
            _id: "63b13ad9863e4dbc14939990",
            author: {
              _id: "639c1da222cb24eca949b6ad",
              name: "Kelly2",
              email: "kelly.nguyen.02s@gmail.com",
              phoneNumber: "0966044156",
              avatarUrl: "",
              aboutMe: "Hanoi",
              jobTitle: "",
              faceBookLink: "",
              instagramLink: "",
              createdAt: "2022-12-16T07:26:26.566Z",
              updatedAt: "2023-01-01T08:24:30.237Z",
              __v: 0,
            },
            title: "test",
            imageUrl: "test",
            address: "test",
            price: 32,
            noBedroom: 5,
            noBathroom: 3,
            description: "hello",
            area: "24",
            status: "available",
            createdAt: "2023-01-01T07:48:41.800Z",
            updatedAt: "2023-01-01T07:48:41.800Z",
            __v: 0,
          },
        ],
        totalPage: 2,
        count: 16,
      },
      message: "Get All Post User Can See Success",
    });
  });

  test("GET / --> Get all posts an user can see with pagination", async () => {
    const { body } = await request(app)
      .get("/api/posts")
      .set(
        "Authorization",
        "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MzliNjFiMGRiMjg5YzhjZGE3Y2U1OTUiLCJpYXQiOjE2NzI1OTI3OTQsImV4cCI6MTY3MjY3OTE5NH0.3oi8Wbl1WEsxtIXJugwzKkif6UcxzMeriDwt4wyJ5Ls"
      )
      .query({ page: 1, limit: 10, name: "tro" })
      .expect(500);
    expect(body).toEqual({
      errMessage: '"name" is not allowed',
    });
  });
});
